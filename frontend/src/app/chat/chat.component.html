<div class="chat-container">
  <header class="chat-header">
    <div class="logo-title">
      <img src="assets/logo.png" alt="THWS Logo" class="thws-logo" />
      <h2>ESG Chatbot</h2>
    </div>

    <div class="header-actions">
      <label for="fileInput" class="upload-btn">Dateien hochladen</label>
      <input
        type="file"
        id="fileInput"
        accept=".pdf"
        multiple
        (change)="onFilesSelected($event)"
        hidden
      />

      <button
        class="upload-confirm-btn"
        (click)="uploadFiles()"
        [disabled]="loading || !selectedFiles"
      >
        {{ loading ? 'Wird verarbeitet…' : 'Index aktualisieren' }}
      </button>

      <button class="logout-btn" (click)="logout()">Abmelden</button>
    </div>
  </header>

  <div class="chat-window" #chatWindow>
    <div
      *ngFor="let msg of messages"
      [ngClass]="{
        'user-msg': msg.sender === 'user',
        'bot-msg': msg.sender === 'bot'
      }"
      class="message"
    >
      <div class="msg-bubble">
        <p>{{ msg.text }}</p>

        <div
          *ngIf="msg.sender === 'bot' && msg.sources?.length"
          class="sources"
        >
          <strong>Quellen:</strong>
          <ul>
            <li *ngFor="let s of msg.sources">
              {{ s.source }} (Seite {{ s.page }})
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <form class="chat-input" (submit)="send(); $event.preventDefault()">
    <textarea
      [(ngModel)]="question"
      name="question"
      placeholder="Stelle eine ESG-bezogene Frage..."
      rows="2"
      required
      (keydown)="onKeyDown($event)"
    ></textarea>

    <button type="submit" [disabled]="loading || !question.trim()">
      {{ loading ? '…' : 'Senden' }}
    </button>
  </form>
</div>
